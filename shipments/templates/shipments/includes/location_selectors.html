{% load static %}

<div class="form-group">
    <label for="{{ country_id }}">Country</label>
    <select class="form-control country-select" id="{{ country_id }}" name="{{ country_name }}" required>
        <option value="">Select Country</option>
    </select>
</div>

<div class="form-group">
    <label for="{{ city_id }}">City</label>
    <select class="form-control city-select" id="{{ city_id }}" name="{{ city_name }}" required>
        <option value="">Select City</option>
    </select>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const countrySelect = document.getElementById('{{ country_id }}');
    const citySelect = document.getElementById('{{ city_id }}');
    
    // Load countries on page load
    fetch('{% url "get_countries" %}')
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(countries => {
            countries.forEach(country => {
                const option = new Option(country.name, country.id);
                countrySelect.add(option);
            });
        })
        .catch(error => {
            console.error('Error loading countries:', error);
            countrySelect.innerHTML = '<option value="">Error loading countries</option>';
        });

    // Update cities when country changes
    countrySelect.addEventListener('change', function() {
        const countryId = this.value;
        citySelect.innerHTML = '<option value="">Select City</option>';
        
        if (countryId) {
            fetch(`{% url "get_cities" %}?country_id=${countryId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(cities => {
                    cities.forEach(city => {
                        const option = new Option(city.name, city.id);
                        citySelect.add(option);
                    });
                })
                .catch(error => {
                    console.error('Error loading cities:', error);
                    citySelect.innerHTML = '<option value="">Error loading cities</option>';
                });
        }
    });
});
</script> 